import ProjectStatus from "../scalar/ProjectStatus";
import Environment from "../scalar/Environment";

function createProject(_, { input }, { dataSources: { projects, users } }) {
  const defaultNamespace = {
    name: "test-namespace-name", // How is the namespace name created? Is it from user input or is it generated by the api?
    cpuQuota: "test-cpu-quota",
    memoryQuota: "test-memory-quota",
    storageQuota: "test-storage-quota",
    snapshotQuota: "test-snapshot-quota",
  };

  const productionNamespace = {
    environment: Environment.PRODUCTION,
    ...defaultNamespace,
  };
  const testNamespace = { environment: Environment.TEST, ...defaultNamespace };

  const defaultProperties = {
    archived: false,
    created: new Date(),
    productionNamespace,
    testNamespace,
    developmentNamespace: {
      environment: Environment.PROD,
      ...defaultNamespace,
    },
    toolsNamespace: { environment: Environment.TOOLS, ...defaultNamespace },
    requestHistory: [],
    status: ProjectStatus.SUBMITTED,
  };

  const project = projects.create({ ...input, ...defaultProperties });

  // Find owner and technical lead user documents and add project id
  users.addElementToArrayById(input.productOwnerUserId, {
    [projectOwner]: project._id,
  });
  users.addElementToArraysByIds(input.technicalLeadsUserIds, {
    [technicalLead]: project._id,
  });

  return project;
}

export default createProject;
